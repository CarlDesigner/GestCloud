---
import LayoutSidebar from '../app/LayoutSidebar.astro';
import ModalDirectorio from '../components/ModalDirectorio.astro';
import HistorialApartamento from '../components/HistorialApartamento.astro';
import AlertNotification from '../components/AlertNotification.astro';
import DeleteConfirmModal from '../components/DeleteConfirmModal.astro';
---

<LayoutSidebar title="Directorio de Apartamentos">
	<div
		class="p-4 bg-white block sm:flex items-center justify-between border-b border-gray-200 lg:mt-1.5 dark:bg-gray-800 dark:border-gray-700"
	>
		<div class="w-full mb-1">
			<div class="mb-4">
				<nav class="flex mb-5" aria-label="Breadcrumb">
					<ol
						class="inline-flex items-center space-x-1 text-sm font-medium md:space-x-2"
					>
						<li class="inline-flex items-center">
							<a
								href="#"
								class="inline-flex items-center text-gray-700 hover:text-primary-600 dark:text-gray-300 dark:hover:text-white"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="20"
									height="20"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
									class="lucide lucide-home mr-2.5"
									><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
									></path><polyline points="9,22 9,12 15,12 15,22"
									></polyline></svg
								>
								Gestión
							</a>
						</li>
						<li>
							<div class="flex items-center">
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="24"
									height="24"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
									class="lucide lucide-chevron-right w-6 h-6 text-gray-400"
									><path d="m9 18 6-6-6-6"></path></svg
								>
								<span
									class="ml-1 text-gray-400 md:ml-2 dark:text-gray-500"
									aria-current="page">Directorio</span
								>
							</div>
						</li>
					</ol>
				</nav>
				<h1
					class="text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white"
				>
					Directorio de Apartamentos
				</h1>
				<p class="text-gray-600 dark:text-gray-400 mt-2">
					Aquí irá el contenido del directorio.
				</p>
				<!-- ALERTA VISUAL -->
				<div
					id="alerta-directorio"
					class="alert alert-info hidden"
					style="position:fixed;top:20px;right:20px;z-index:9999;min-width:220px;"
				>
				</div>

				<!-- Barra de búsqueda y botón agregar (solo una vez, igual que en historial) -->
				<div
					class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-4"
				>
					<div
						class="flex flex-col sm:flex-row items-start sm:items-center gap-3 flex-1"
					>
						<div class="relative w-full sm:w-80">
							<div
								class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
									class="lucide lucide-search text-gray-400"
									><circle cx="11" cy="11" r="8"></circle><path
										d="m21 21-4.35-4.35"></path></svg
								>
							</div>
							<div class="relative">
								<input
										type="text"
										id="table-search"
										class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-9 pr-8 py-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 shadow-sm"
										placeholder="Buscar por apartamento, residente..."
								/>
								<button
									type="button"
									id="btn-limpiar-busqueda"
									class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500 focus:outline-none"
									style="display:none"
									title="Limpiar búsqueda"
								>
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x w-4 h-4">
										<line x1="18" y1="6" x2="6" y2="18"></line>
										<line x1="6" y1="6" x2="18" y2="18"></line>
									</svg>
								</button>
							</div>
						</div>
					</div>
					<div class="flex flex-row items-center gap-2 mt-4 lg:mt-0">
						<!-- Botón de filtro -->
						<div class="relative flex flex-row items-center gap-1">
							<button
								type="button"
								id="btn-filtrar-directorio"
								class="flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
									class="lucide lucide-filter w-4 h-4 mr-2"
									><polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"
									></polygon></svg
								>
								Filtrar <span
									id="filtro-contador-directorio"
									class="hidden ml-1 text-xs bg-primary-600 text-white px-2 py-0.5 rounded-full"
									>0</span
								>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
									class="lucide lucide-chevron-down w-4 h-4 ml-1"
									><path d="m6 9 6 6 6-6"></path></svg
								>
							</button>
							<!-- Botón para limpiar filtro -->
							<button
								type="button"
								id="btn-limpiar-filtro-directorio"
								class="ml-1 p-2 rounded-full border border-gray-200 bg-white text-gray-400 hover:text-red-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-red-200 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-500 dark:hover:text-red-400 dark:hover:bg-gray-700"
								title="Quitar filtro"
								style="display:none"
							>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x w-4 h-4">
									<line x1="18" y1="6" x2="6" y2="18"></line>
									<line x1="6" y1="6" x2="18" y2="18"></line>
								</svg>
							</button>
							<!-- Dropdown de filtros -->
							<div
								id="dropdown-filtros-directorio"
								class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 dark:bg-gray-800 dark:border-gray-700 z-10"
							>
								<div class="p-3">
									<h6
										class="text-sm font-medium text-gray-900 dark:text-white mb-3"
									>
										Filtrar por estado
									</h6>
									<ul class="space-y-2">
										<li>
											<label class="flex items-center">
												<input
													type="radio"
													name="filtro-estado-directorio"
													value="todos"
													checked
													class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"
												/>
												<span class="ml-2 text-sm text-gray-900 dark:text-white"
													>Todos</span
												>
												<span
													id="contador-directorio-todos"
													class="ml-auto text-xs text-gray-500 dark:text-gray-400"
													>(0)</span
												>
											</label>
										</li>
										<li>
											<label class="flex items-center">
												<input
													type="radio"
													name="filtro-estado-directorio"
													value="Ocupado"
													class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"
												/>
												<span class="ml-2 text-sm text-gray-900 dark:text-white"
													>Ocupado</span
												>
												<span
													id="contador-directorio-ocupado"
													class="ml-auto text-xs text-gray-500 dark:text-gray-400"
													>(0)</span
												>
											</label>
										</li>
										<li>
											<label class="flex items-center">
												<input
													type="radio"
													name="filtro-estado-directorio"
													value="Desocupado"
													class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"
												/>
												<span class="ml-2 text-sm text-gray-900 dark:text-white"
													>Desocupado</span
												>
												<span
													id="contador-directorio-desocupado"
													class="ml-auto text-xs text-gray-500 dark:text-gray-400"
													>(0)</span
												>
											</label>
										</li>
										<li>
											<label class="flex items-center">
												<input
													type="radio"
													name="filtro-estado-directorio"
													value="En arriendo"
													class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"
												/>
												<span class="ml-2 text-sm text-gray-900 dark:text-white"
													>En arriendo</span
												>
												<span
													id="contador-directorio-arriendo"
													class="ml-auto text-xs text-gray-500 dark:text-gray-400"
													>(0)</span
												>
											</label>
										</li>
										<li>
											<label class="flex items-center">
												<input
													type="radio"
													name="filtro-estado-directorio"
													value="En venta"
													class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"
												/>
												<span class="ml-2 text-sm text-gray-900 dark:text-white"
													>En venta</span
												>
												<span
													id="contador-directorio-venta"
													class="ml-auto text-xs text-gray-500 dark:text-gray-400"
													>(0)</span
												>
											</label>
										</li>
									</ul>
								</div>
							</div>
						</div>
						<!-- Botón agregar apartamento -->
						<button
							id="btn-abrir-modal-apto"
							class="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg shadow hover:bg-blue-700 focus:ring-4 focus:ring-blue-300"
						>
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="18"
								height="18"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="lucide lucide-plus mr-2"
								><line x1="12" y1="5" x2="12" y2="19"></line><line
									x1="5"
									y1="12"
									x2="19"
									y2="12"></line></svg
							>
							Agregar apartamento
						</button>
					</div>
				</div>

				<!-- Separador visual como en el historial -->
				<hr class="my-6 border-t-2 border-gray-200 dark:border-gray-700" />
				<!-- Contenedor principal del directorio -->
				<div
					class="bg-white dark:bg-gray-800 relative shadow-md sm:rounded-lg overflow-hidden"
				>
					<!-- Estadísticas (puedes personalizar o eliminar si no las necesitas) -->
					<div
						class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 border-b dark:border-gray-700"
					>
						<div class="flex items-center space-x-6">
							<div class="flex items-center">
								<span
									class="text-sm font-medium text-gray-500 dark:text-gray-400"
									>Total apartamentos:</span
								>
								<span
									id="total-apartamentos"
									class="ml-2 text-lg font-bold text-gray-900 dark:text-white"
									>0</span
								>
							</div>
						</div>
					</div>
					<!-- Estado sin datos -->
					<div id="sin-directorio" class="text-center py-16 hidden">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="96"
							height="96"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="1"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="lucide lucide-clipboard-list mx-auto h-24 w-24 text-gray-400 dark:text-gray-600 mb-4"
							><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path
								d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
							></path><path d="M12 11h4"></path><path d="M12 16h4"></path><path
								d="M8 11h.01"></path><path d="M8 16h.01"></path></svg
						>
						<h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
							No hay apartamentos registrados
						</h3>
						<p class="text-gray-500 dark:text-gray-400 mb-6">
							Cuando registres apartamentos aparecerán aquí
						</p>
						<button
							id="btn-abrir-modal-apto-2"
							class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700"
						>
							Agregar Apartamento
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="18"
								height="18"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="lucide lucide-plus ml-2"
								><line x1="12" y1="5" x2="12" y2="19"></line><line
									x1="5"
									y1="12"
									x2="19"
									y2="12"></line></svg
							>
						</button>
					</div>
					<!-- Tabla de apartamentos -->
					<div id="tabla-directorio" class="overflow-x-auto">
						<table
							class="w-full text-sm text-left text-gray-500 dark:text-gray-400 table-fixed"
						>
							<thead
								class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
							>
								<tr>
									<th class="px-4 py-3 w-1/8">N° Apartamento</th>
									<th class="px-4 py-3 w-1/8">Estado</th>
									<th class="px-4 py-3 w-1/8">Residente principal</th>
									<th class="px-4 py-3 w-1/8">Contacto</th>
									<th class="px-4 py-3 w-1/8">Rol</th>
									<th class="px-4 py-3 w-1/8">Parqueadero</th>
									<th class="px-4 py-3 w-1/8">Observaciones</th>
									<th class="px-4 py-3 w-1/8">Historial</th>
									<th class="px-4 py-3 w-16"
										><span class="sr-only">Acciones</span></th
									>
								</tr>
							</thead>
							<tbody id="tabla-directorio-body">
								<!-- Los datos se cargarán dinámicamente aquí -->
								<!-- Ejemplo de fila, reemplazar por render dinámico en JS -->
								<!--
				<tr>
				  <td class="px-4 py-3">
					<button class="text-blue-600 underline font-semibold cursor-pointer focus:outline-none hover:text-blue-800 transition-colors" style="background: none; border: none; padding: 0;" onclick="mostrarDetallesApartamento('101')">101</button>
				  </td>
				  <td class="px-4 py-3">Ocupado</td>
				  <td class="px-4 py-3">Juan Pérez</td>
				  <td class="px-4 py-3">3001234567</td>
				  <td class="px-4 py-3">Propietario</td>
				  <td class="px-4 py-3">Sin observaciones</td>
				  <td class="px-4 py-3 w-16">
					<div class="flex items-center justify-end">
					  <button class="inline-flex items-center p-0.5 text-sm font-medium text-center text-gray-500 hover:text-gray-800 rounded-lg focus:outline-none dark:text-gray-400 dark:hover:text-gray-100" onclick="mostrarMenuAccionesDirectorio(event, '101')">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-more-horizontal w-5 h-5"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
					  </button>
					</div>
				  </td>
				</tr>
				-->
							</tbody>
						</table>
					</div>
					<!-- Paginación -->
					<nav
						id="paginacion-directorio"
						class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4"
						aria-label="Table navigation"
					>
						<span class="text-sm font-normal text-gray-500 dark:text-gray-400">
							Mostrando
							<span
								class="font-semibold text-gray-900 dark:text-white"
								id="inicio-rango-directorio">1</span
							>
							-
							<span
								class="font-semibold text-gray-900 dark:text-white"
								id="fin-rango-directorio">10</span
							>
							de
							<span
								class="font-semibold text-gray-900 dark:text-white"
								id="total-items-directorio">0</span
							>
						</span>
						<ul class="inline-flex items-stretch -space-x-px">
							<li>
								<button
									id="btn-primera-directorio"
									class="flex items-center justify-center h-full py-1.5 px-3 ml-0 text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
									title="Primera página"
								>
									<span class="sr-only">Primera</span>
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-left w-5 h-5"><polyline points="11 17 6 12 11 7"/><polyline points="18 17 13 12 18 7"/></svg>
								</button>
							</li>
							<li>
								<button
									id="btn-anterior-directorio"
									class="flex items-center justify-center h-full py-1.5 px-3 text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
									title="Anterior"
								>
									<span class="sr-only">Anterior</span>
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left w-5 h-5"><path d="m15 18-6-6 6-6"></path></svg>
								</button>
							</li>
							<li>
								<span
									id="numero-pagina-directorio"
									class="flex items-center justify-center text-sm py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
									>1</span
								>
							</li>
							<li>
								<button
									id="btn-siguiente-directorio"
									class="flex items-center justify-center h-full py-1.5 px-3 text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
									title="Siguiente"
								>
									<span class="sr-only">Siguiente</span>
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right w-5 h-5"><path d="m9 18 6-6-6-6"></path></svg>
								</button>
							</li>
							<li>
								<button
									id="btn-ultima-directorio"
									class="flex items-center justify-center h-full py-1.5 px-3 text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
									title="Última página"
								>
									<span class="sr-only">Última</span>
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-right w-5 h-5"><polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/></svg>
								</button>
							</li>
						</ul>
					</nav>
				</div>
			</div>
			<!-- ...existing code... (ya está la barra de búsqueda y botón arriba, eliminamos este bloque duplicado) -->
		</div>
	</div>
	<!-- Script para la lógica del directorio -->
	<script>
		// @ts-nocheck
		// Script del cliente para manejar directorio con historial
		import '../scripts/directorio-ui';
	</script>
</LayoutSidebar>
<ModalDirectorio />
<HistorialApartamento />
<AlertNotification />
<DeleteConfirmModal />
